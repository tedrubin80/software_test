# FILE LOCATION: /Dockerfile (root directory)
FROM node:18-alpine

WORKDIR /app

# First, let's see what files are being copied
COPY . .
RUN echo "=== ALL FILES IN ROOT ===" && \
    ls -la && \
    echo "=== CHECKING FOR SERVER FILES ===" && \
    ls -la *.js || echo "No JS files found" && \
    echo "=== CHECKING PACKAGE.JSON ===" && \
    cat package.json && \
    echo "=== REMOVING PROBLEMATIC FILES ===" && \
    rm -f railway-server.js combined-server.js || echo "No files to remove"

# Now install dependencies
COPY package*.json ./
RUN npm install

# Final check
RUN echo "=== FINAL FILE LIST ===" && \
    ls -la && \
    echo "=== NODE VERSION ===" && \
    node --version

# Make absolutely sure we run the right file
ENTRYPOINT ["node"]
CMD ["simple-server.js"]